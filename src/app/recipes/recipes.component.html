<div class="recipes-container">
  <!-- Header Section -->
  <div class="recipes-header animate-fade-in">
    <div class="header-content">
      <h1 class="page-title font-display">Recipe Collection</h1>
      <p class="page-subtitle">Discover and manage your healthy recipes</p>
    </div>

    <div class="header-actions">
      <button mat-flat-button class="btn btn-primary" routerLink="/add-recipe">
        <mat-icon>add_circle</mat-icon>
        <span>New Recipe</span>
      </button>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section animate-slide-in-down">
    <app-recipe-search (search)="onSearch($event)"></app-recipe-search>
  </div>

  <!-- Recipes Grid -->
  <div class="recipes-grid">
    <div *ngFor="let recipe of recipes | async; let i = index"
         class="recipe-card card animate-slide-in-up"
         [style.animation-delay]="(i * 0.05) + 's'">

      <!-- Recipe Image -->
      <div class="recipe-image-container" *ngIf="recipe.hasImage">
        <img [src]="getImageUrl(recipe.id!)"
             [alt]="recipe.name"
             loading="lazy"
             class="recipe-image"
             (error)="handleImageError($event)">
        <div class="image-overlay">
          <div class="servings-badge badge badge-secondary">
            <mat-icon>restaurant</mat-icon>
            <span>{{ recipe.servings }} servings</span>
          </div>
        </div>
      </div>

      <!-- Recipe Content -->
      <div class="recipe-content">
        <!-- Recipe Title -->
        <h2 class="recipe-title font-display">{{ recipe.name }}</h2>

        <!-- Recipe Links -->
        <div class="recipe-links" *ngIf="recipe.link">
          <a [href]="recipe.link" target="_blank" class="recipe-link">
            <mat-icon>link</mat-icon>
            <span>View Original</span>
          </a>
        </div>

        <!-- Recipe Description -->
        <p class="recipe-description" *ngIf="recipe.description">
          {{ recipe.description }}
        </p>

        <!-- Nutrition Info -->
        <div class="nutrition-section">
          <!-- Per Serving -->
          <div class="nutrition-per-serving" *ngIf="recipe.caloriesPerServing">
            <span class="label">Per Serving:</span>
            <app-macro-pills
              [calories]="recipe.caloriesPerServing"
              [protein]="recipe.proteinPerServing"
              [carbs]="recipe.carbohydratesPerServing"
              [fat]="recipe.fatPerServing"
              size="small"
              layout="horizontal"
              [showLabels]="true"
            ></app-macro-pills>
          </div>

          <!-- Total -->
          <div class="nutrition-total">
            <span class="label">Total:</span>
            <app-macro-pills
              [calories]="recipe.sumCalories"
              [protein]="recipe.sumProtein"
              [carbs]="recipe.sumCarbohydrates"
              [fat]="recipe.sumFat"
              size="small"
              layout="horizontal"
              [showLabels]="true"
            ></app-macro-pills>
          </div>
        </div>

        <!-- Ingredients (Collapsible) -->
        <details class="ingredients-details">
          <summary class="ingredients-summary">
            <mat-icon>restaurant_menu</mat-icon>
            <span>View Ingredients ({{ recipe.itemsUsed.length }})</span>
          </summary>
          <div class="ingredients-content">
            <app-items-table [items]="recipe.itemsUsed"></app-items-table>
          </div>
        </details>

        <!-- Recipe Actions -->
        <div class="recipe-actions">
          <div class="action-buttons">
            <button mat-flat-button class="btn btn-secondary" [routerLink]="['/edit-recipe', recipe.id]">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>

            <button *ngIf="recipe.hasPdf" mat-stroked-button (click)="openPdf(recipe.id!)">
              <mat-icon>picture_as_pdf</mat-icon>
              <span>View PDF</span>
            </button>

            <app-add-to-day-button
              [recipeId]="recipe.id"
              [toAdd]="{name: recipe.name, itemsUsed: recipe.itemsUsed}"
              [servings]="recipe.servings"
              (actionMadeEmitter)="refreshDay($event)"
              [buttonText]="'Add to Day'"
            ></app-add-to-day-button>

            <button mat-icon-button class="delete-icon-btn" (click)="confirmDelete(recipe)" matTooltip="Delete recipe">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="(recipes | async)?.length === 0" class="empty-state animate-scale-in">
    <div class="empty-icon">ðŸ“–</div>
    <h3>No Recipes Found</h3>
    <p>Start building your recipe collection by adding your first recipe</p>
    <button mat-flat-button class="btn btn-primary btn-lg" routerLink="/add-recipe">
      <mat-icon>add</mat-icon>
      Create Your First Recipe
    </button>
  </div>
</div>
